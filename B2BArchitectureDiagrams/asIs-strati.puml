@startuml
!include <cloudinsight/mongodb>
!include <cloudinsight/kafka>
!include <cloudinsight/redis>
!include <cloudinsight/haproxy>
!include <cloudinsight/sqlserver>
!include <cloudinsight/nodejs>
!include <cloudinsight/redis>
!include <logos/oracle>
left to right direction
skinparam linetype ortho
title B2B - Strati Deployment

rectangle walmartChile as "Walmart Chile" {
    database atgDatabase as "\nATG\n<$oracle{scale=.4}>\n" #DarkGrey;line:white;line.bold;text:white
            rectangle modelMaster as "Modelo Maestro ETL" #DarkGrey;line:white;line.bold;text:white
    rectangle mercurioChile as "Mercurio - B2B" {
        rectangle b2bService as "<$nodejs{scale=.5}> b2b-service" #RoyalBlue;line:white;line.bold;text:white
        database redisCache as "\n<$redis{scale=.5}> Redis\n" #RoyalBlue;line:white;line.bold;text:white
        folder ftp #RoyalBlue;line:white;line.bold;text:white

        queue _mercurioHatChanged as "<$kafka{scale=.5}> _mercurio-hat-changed-*" #black;line:white;line.bold;text:white
        queue _mercurioBrandChanged as "<$kafka{scale=.5}> _mercurio-brand-changed-*" #black;line:white;line.bold;text:white
        queue _mercurioVendorChanged as "<$kafka{scale=.5}> _mercurio-vendor-changed-*" #black;line:white;line.bold;text:white
        queue _mercurioSkuChanged as "<$kafka{scale=.5}> _mercurio-item-sku-changed-*" #black;line:white;line.bold;text:white
        queue _mercurioSkuRemoved as "<$kafka{scale=.5}> _mercurio-item-sku-removed-*" #black;line:white;line.bold;text:white
        queue _mercurioCeOrderPaid as "<$kafka{scale=.5}> _mercurio-ce-order-paid-*" #black;line:white;line.bold;text:white
    }
}

rectangle walmartGlobal as "Walmart Global" {
    rectangle mercurioGlobal as "Mercurio - B2B" {

    }
}

queue replicator as "<$kafka{scale=.5}> Replicator" #black;line:white;line.bold;text:white {
}



b2bService -[#RoyalBlue]-> atgDatabase: "Get Sku, brand, vendor and rut"
b2bService <-[#RoyalBlue]-> redisCache: "Cache items information"
modelMaster -[#DarkGrey]-> ftp
b2bService -[#RoyalBlue]-> ftp

b2bService -[#RoyalBlue]--> _mercurioHatChanged
b2bService -[#RoyalBlue]--> _mercurioBrandChanged
b2bService -[#RoyalBlue]--> _mercurioVendorChanged
b2bService -[#RoyalBlue]--> _mercurioSkuChanged
b2bService -[#RoyalBlue]--> _mercurioSkuRemoved
b2bService -[#RoyalBlue]-> _mercurioCeOrderPaid

@enduml